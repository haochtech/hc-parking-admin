{template 'newheader'}
{template "wxconfig"}
<style>
    .aui-flexView {
        width: 100%;
        height: 100%;
        margin: 0 auto;
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -webkit-flex-direction: column;
        -ms-flex-direction: column;
        flex-direction: column;
    }

    .aui-scrollView {
        width: 100%;
        height: 100%;
        -webkit-box-flex: 1;
        -webkit-flex: 1;
        -ms-flex: 1;
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        position: relative;
    }
    .aui-grids-item-icon img {
        width: 45px;
        height: 45px;
        display: block;
        border-radius: 100%;
    }
    .aui-grids-item-text {
        color: #333;
        padding-top:0.3rem;
    }


    .aui-used-title-head {
        width: 100%;
        text-align: center;
        background: #fff;
        padding: 0.2rem 0 ;
    }

    .aui-used-title-head h2 {
        font-weight: normal;
        color: #afafaf;
        font-size: 0.95rem;
        position: relative;
    }

    .aui-used-title-head h2:before {
        content: '';
        position: absolute;
        z-index: 0;
        top: 10px;
        right: 50%;
        width: 30%;
        margin-right: 10%;
        height: 1px;
        border-bottom: 1px solid #D9D9D9;
        -webkit-transform: scaleY(0.5);
        transform: scaleY(0.5);
        -webkit-transform-origin: 0 100%;
        transform-origin: 0 100%;
    }

    .aui-used-title-head h2:after {
        content: '';
        position: absolute;
        z-index: 0;
        top: 10px;
        left: 50%;
        width: 30%;
        margin-left: 10%;
        height: 1px;
        border-bottom: 1px solid #D9D9D9;
        -webkit-transform: scaleY(0.5);
        transform: scaleY(0.5);
        -webkit-transform-origin: 0 100%;
        transform-origin: 0 100%;
    }


    .aui-used-layout {
        background: #fff;
        position: relative;
        padding: 0 2px 15px 2px;
        overflow: hidden;
    }

    .aui-grids-item {
        position: relative;
        float: left;
        width: 25%;
        box-sizing: border-box;
    }

    .aui-grids-item:not(:nth-child(4n)):before {
        content: '';
        width: 0;
        height: 0;
        border-width: 5px 0px 5px 8px;
        border-style: solid;
        border-color: transparent transparent transparent #3259ce;
        position: absolute;
        top: 32%;
        right: -4px;
        border-radius: 1px;
    }

    .aui-grids-item-img {
        text-align: center;
        width: 100%;
        display: block;
        color: #323232;
        font-size: 1rem;
    }

    .aui-grids-item-img img {
        width: 30px;
        height: 30px;
        display: block;
        border: none;
        margin: 0 auto;
    }

    .aui-grids-item-text {
        text-align: center;
        width: 100%;
        display: block;
        color: #666666;
        font-size: 0.7rem;
        padding-top: 5px;
    }


    .aui-text-title{
        width:100%;
        text-align:center;
        padding-top:1rem;
    }

    .aui-text-title h1{
        font-size:1rem;
        color:#101d37;
        font-weight:normal;
    }

    .aui-button-plus{
        width:100%;
        padding-top:1rem;
    }

    .aui-button{
        border:none;
        background-image: -webkit-gradient(linear,left top,right top,from(#60a5f5),to(#006ae3));
        background-image: -webkit-linear-gradient(left,#60a5f5,#006ae3);
        background-image: -moz-linear-gradient(left,#60a5f5,#006ae3);
        background-image: linear-gradient(to right,#60a5f5,#006ae3);
        background-color: #006ae3;
        border-radius:5px;
        color:#fff;
        width:90%;
        margin:0 auto;
        display:block;
        height:3rem;
        line-height:3rem;
        font-size:0.85rem;
    }
    .aui-btn-disabled{
        border:none;
        background-image: -webkit-gradient(linear,left top,right top,from(#888a85),to(#888a85));
        background-image: -webkit-linear-gradient(left,#888a85,#888a85);
        background-image: -moz-linear-gradient(left,#888a85,#888a85);
        background-image: linear-gradient(to right,#888a85,#888a85);
        background-color: #006ae3;
        border-radius:5px;
        color:#fff;
        width:90%;
        margin:0 auto;
        display:block;
        height:3rem;
        line-height:3rem;
        font-size:0.85rem;
    }
</style>
<section class="aui-flexView">
    <div class="aui-scrollView">
        <img src="{MODULE_URL}/template/static/new/images/weizhangad.png" width="100%"/>
        <div class="aui-used-title-head">
            <h2>开通流程</h2>
        </div>

        <div class="aui-used-layout">
            <a href="javascript:;" class="aui-grids-item">
                            <span class="aui-grids-item-img">
                                <img src="{MODULE_URL}/template/static/new/images/icon-re-06.png" alt="">
                            </span>
                <span class="aui-grids-item-text">填写信息</span>
            </a>
            <a href="javascript:;" class="aui-grids-item">
                            <span class="aui-grids-item-img">
                               <img src="{MODULE_URL}/template/static/new/images/icon-re-07.png" alt="">
                            </span>
                <span class="aui-grids-item-text">信息核实</span>
            </a>
            <a href="javascript:;" class="aui-grids-item">
                            <span class="aui-grids-item-img">
                               <img src="{MODULE_URL}/template/static/new/images/icon-re-08.png" alt="">
                            </span>
                <span class="aui-grids-item-text">费用支付</span>
            </a>
            <a href="javascript:;" class="aui-grids-item">
                            <span class="aui-grids-item-img">
                                <img src="{MODULE_URL}/template/static/new/images/icon-re-09.png" alt="">
                            </span>
                <span class="aui-grids-item-text">按时推送</span>
            </a>
        </div>

        {if $carinfo['engineno'] and $carinfo['classno']}
        <div style="margin-top:10px ">
            <div style="text-align: center;">
                <img width="50px" src="{MODULE_URL}/template/static/new/images/icon-re-07.png" alt="">
            </div>
            <div style="text-align: center;">
            信息验证成功！
            </div>
        </div>

        {else}
        <div class="aui-form-cells">
            <div class="aui-form-cell b-line">
                <div class="aui-form-cell-td">
                    <label style="width: auto">发动机号:</label>
                </div>
                <div class="aui-form-cell-tb">
                    <input type="text" id="fdj"  placeholder="{if  $post['result']['engineno']=='0'}请输入完整的发动机号{else}请输入发动号后{$post['result']['engineno']}位{/if}">
                </div>
            </div>
            <div class="aui-form-cell b-line">
                <div class="aui-form-cell-td">
                    <label style="width: auto">车架号:</label>
                </div>
                <div class="aui-form-cell-tb">
                    <input type="text" id="cj"  placeholder="{if  $post['result']['classno']=='0'}请输入完整的车架号{else}请输入车架号后{$post['result']['classno']}位{/if}">
                </div>
            </div>
        </div>
        {/if}
        <div class="aui-button-plus">
            {if $carinfo['engineno'] and $carinfo['classno']}
            <button class="aui-button" onclick="post()">微信支付</button>
            <div style="text-align: center;margin-top: 5px">
                <a onclick="jihuo();" style="text-decoration: underline;color: #0d6aad">激活码激活</a>
            </div>
            <button class="aui-btn-disabled" style="display: none" >支付中···</button>
            {else}
            <button class="aui-button" onclick="post()">验证车辆</button>
            {/if}
        </div>
    </section>
</section>
<script>
    function post() {
        {if $carinfo['engineno'] and $carinfo['classno']}
        $('.aui-button').hide();
        $('.aui-btn-disabled').show();
        $.post('',{'action':'order'},function (data, status) {
            if(status == 'success'){
                util.pay({
                    orderFee : data.free,
                    payMethod : 'wechat',
                    orderTitle : '增值服务月费：' + data.free + '元',
                    orderTid : data.order_id,
                    module : 'beta_car',
                    success : function(result) {
                        layer.open({
                            content: '支付成功'
                            ,skin: 'msg'
                            ,time: 2 //2秒后自动关闭
                            ,end:function () {
                                window.location.href='{php echo  $this->createMobileUrl('weizhang',array('action'=>'carlist'))}'
                            }
                        });
                    },
                    fail : function(result) {
                        layer.open({
                            content: '失败：'+result.message
                            ,skin: 'msg'
                            ,time: 2 //2秒后自动关闭
                        });
                    },
                    complete : function (result) {
                        $('.aui-button').show();
                        $('.aui-btn-disabled').hide();
                    }
                });

            }
        },'json')
        {else}
        var fdj = $("#fdj").val();
        var cj = $("#cj").val();
        layer.open({
            shadeClose: false,type: 2
            ,content: '加载中'
        });
        $.post('',{'action':'bind','fdj':fdj,'cj':cj},function (data) {
           if(data.error_code=='0'){window.location.reload();}else{layer.closeAll(); layer.open({
               shadeClose: false,content: data.reason
               ,btn: '我知道了'
           });}
        },'json')
        {/if}
    }
    function jihuo() {
        layer.open({
            content: '<form action="{php echo $this->createMobileUrl('wzcode')}" method="post"><input type="hidden" name="sn" value="{php echo $_GET["sign"]}"><div class="aui-form-cells">\n' +
                '            <div class="aui-form-cell b-line">\n' +
                '                <div class="aui-form-cell-td">\n' +
                '                </div>\n' +
                '                <div class="aui-form-cell-tb">\n' +
                '                    <input type="text" name="jhm" placeholder="请输入激活码">\n' +
                '                </div>\n' +
                '            </div>\n' +
                '            \n' +
                '        </div><br><button class="aui-button">激活车辆</button></form>'
        });
    }
</script>
{template 'footer'}